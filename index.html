<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game Radar</title>
    <style>
        canvas {
            border: 1px solid black;
        }
    </style>
    <script>
        let source;
        function startVisualization() {
            const token = document.getElementById('token').value;
            source = new EventSource(`https://link.elocarry.net/data/${token}`);
            source.onmessage = function(event) {
                let data = JSON.parse(event.data);
                updateRadar(data);
            };
        }

        function updateRadar(data) {
            let canvas = document.getElementById('radar');
            let context = canvas.getContext('2d');
            context.clearRect(0, 0, canvas.width, canvas.height);

            // Draw players
            data.ps.forEach(player => {
                context.fillStyle = player.t === 1 ? 'blue' : 'red';
                context.beginPath();
                context.arc(player.p[0], player.p[1], 5, 0, 2 * Math.PI);
                context.fill();

                // Draw direction indicator based on look_direction
                context.strokeStyle = 'black';
                context.beginPath();
                let angleRad = player.l[0] * (Math.PI / 180);
                context.moveTo(player.p[0], player.p[1]);
                context.lineTo(player.p[0] + 10 * Math.cos(angleRad), player.p[1] + 10 * Math.sin(angleRad));
                context.stroke();
            });

            // Draw skills
            data.ss.forEach(skill => {
                context.fillStyle = skill.t === 1 ? 'green' : 'purple';
                context.beginPath();
                context.arc(skill.p[0], skill.p[1], 3, 0, 2 * Math.PI);
                context.fill();
            });
        }
    </script>
</head>
<body>
    <input type="text" id="token" placeholder="Enter Token">
    <button onclick="startVisualization()">Start Visualization</button>
    <canvas id="radar" width="500" height="500"></canvas>
</body>
</html>
